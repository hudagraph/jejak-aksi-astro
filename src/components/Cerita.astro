---
import { getCollection } from 'astro:content';

// Ambil data
const allCerita = await getCollection('cerita');
// Urutkan
const sortedCerita = allCerita.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
// AMBIL CUMA 3 TERBARU (Slice)
const recentCerita = sortedCerita.slice(0, 3);
---

<section id="cerita" class="py-16 border-t border-gray-100">
  <div class="max-w-6xl mx-auto px-4 reveal">
    
    <div class="flex items-end justify-between gap-4 mb-8">
        <div>
            <h2 class="font-heading text-3xl font-semibold title-accent">Cerita</h2>
            <p class="text-gray-600 mt-1">Tulisan terbaru dari komunitas Jejak Aksi.</p>
        </div>
        <!-- Tombol "Lihat Semua" (Hanya muncul di Desktop, Mobile di bawah) -->
        <div class="hidden sm:block">
            <a href="/cerita" class="btn-rounded border border-primary text-primary hover:bg-primary hover:text-white text-sm px-6 py-2">
                Lihat Semua Artikel
            </a>
        </div>
    </div>
    
    <div class="section-divider mb-8 opacity-50"></div>
    
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {recentCerita.map((post) => (
        <article class="card rounded-2xl overflow-hidden bg-white border h-full flex flex-col group">
            <a href={`/cerita/${post.slug}`} class="block overflow-hidden h-48">
                <img src={post.data.image} alt={post.data.title} class="w-full h-full object-cover group-hover:scale-105 transition duration-500" loading="lazy" />
            </a>
            <div class="p-5 flex-1 flex flex-col">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs font-semibold text-gray-400">
                        {post.data.date.toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' })}
                    </span>
                </div>
                
                <h3 class="font-heading font-bold text-lg text-primary mb-2 line-clamp-2">
                    <a href={`/cerita/${post.slug}`} class="group-hover:text-accent transition">
                        {post.data.title}
                    </a>
                </h3>
                
                <p class="text-sm text-gray-600 line-clamp-2 mb-4 flex-1">{post.data.description}</p>
                
                <a href={`/cerita/${post.slug}`} class="text-xs font-bold text-primary uppercase tracking-wider hover:underline mt-auto">
                    Baca Artikel
                </a>
            </div>
        </article>
      ))}
    </div>

    {/* Tombol Lihat Semua (Khusus Mobile) */}
    <div class="mt-8 text-center sm:hidden">
        <a href="/cerita" class="btn-rounded border border-primary text-primary w-full block text-center">
            Lihat Semua Artikel
        </a>
    </div>

  </div>
</section>