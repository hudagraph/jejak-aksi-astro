---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

// 1. Ambil SEMUA data cerita
const allCerita = await getCollection('cerita');

// 2. Urutkan dari yang paling baru
const sortedCerita = allCerita.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---

<MainLayout title="Semua Cerita — Jejak Aksi">
  <section class="py-20 bg-gray-50/50">
    <div class="max-w-6xl mx-auto px-4 reveal">
      
      {/* Header Halaman */}
      <div class="text-center mb-12">
        <h1 class="font-heading text-4xl font-bold text-primary mb-4">Jurnal & Cerita</h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
            Kumpulan catatan perjalanan, opini, dan kabar terbaru dari komunitas Jejak Aksi.
        </p>
      </div>

      {/* Grid: Menampilkan SEMUA artikel */}
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
        {sortedCerita.map((post) => (
          <article class="card rounded-2xl overflow-hidden bg-white border h-full flex flex-col hover:-translate-y-1 transition duration-300">
              <a href={`/cerita/${post.slug}`} class="block overflow-hidden">
                <img src={post.data.image} alt={post.data.title} class="w-full h-56 object-cover hover:scale-105 transition duration-500" loading="lazy" />
              </a>
              
              <div class="p-6 flex-1 flex flex-col">
                  {/* Meta */}
                  <div class="flex items-center gap-2 text-xs text-gray-500 mb-3">
                    <span>{post.data.date.toLocaleDateString('id-ID', { year: 'numeric', month: 'short', day: 'numeric' })}</span>
                    <span>•</span>
                    <span>{post.data.author || 'Tim Jejak Aksi'}</span>
                  </div>
                  
                  <h3 class="font-heading font-bold text-xl text-primary mb-3 leading-tight">
                      <a href={`/cerita/${post.slug}`} class="hover:text-accent transition">
                          {post.data.title}
                      </a>
                  </h3>
                  
                  <p class="text-sm text-gray-600 mb-4 line-clamp-3 flex-1">{post.data.description}</p>
                  
                  <a href={`/cerita/${post.slug}`} class="text-sm font-bold text-primary hover:underline mt-auto inline-flex items-center gap-1">
                      Baca Selengkapnya 
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                  </a>
              </div>
          </article>
        ))}
      </div>
      
      {/* Jika belum ada konten */}
      {sortedCerita.length === 0 && (
        <div class="text-center py-20 text-gray-500">
            <p>Belum ada cerita yang ditulis.</p>
        </div>
      )}

      {/* Tombol Balik ke Home */}
      <div class="text-center mt-16 border-t border-gray-200 pt-10">
        <a href="/" class="inline-flex items-center text-primary font-semibold hover:underline">
            ← Kembali ke Beranda
        </a>
      </div>
      
    </div>
  </section>
</MainLayout>