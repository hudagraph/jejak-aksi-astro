---
import { getCollection } from "astro:content";
import MainLayout from "../layouts/MainLayout.astro";
import Navbar from "../components/Navbar.astro";
import Hero from "../components/Hero.astro";
import About from "../components/About.astro";
import Footer from "../components/Footer.astro";

// Import Komponen Tampilan
import Cerita from "../components/Cerita.astro";
import Belajar from "../components/Belajar.astro";
import Proyek from "../components/react/Proyek.jsx";
import Karya from "../components/react/Karya.jsx";
import FaqJoin from "../components/react/FaqJoin.jsx";

// Helper Sort Tanggal
const sortDate = (a, b) =>
  new Date(b.data.pubDate || b.data.date) -
  new Date(a.data.pubDate || a.data.date);

// 1. FETCH DATA (Ambil semua, nanti di-slice)
const allProyek = await getCollection("proyek");
const recentProyek = allProyek.sort(sortDate).slice(0, 3);

const allKarya = await getCollection("karya");
const recentKarya = allKarya.sort(sortDate).slice(0, 3);

const allCerita = await getCollection("cerita");
const recentCerita = allCerita.sort(sortDate).slice(0, 3);

// Handle Belajar (Try-Catch in case collection belum dibuat)
let allBelajar = [];
try {
  allBelajar = await getCollection("belajar");
} catch (e) {
  console.log("Collection belajar belum ada");
}
const recentBelajar = allBelajar.sort(sortDate).slice(0, 3);
---

<MainLayout title="Jejak Aksi â€” Melangkah Bersama, Menorehkan Manfaat">
  <Navbar />
  <main>
    <Hero />
    <About />

    {allProyek.length > 0 && <Proyek client:visible data={recentProyek} />}

    {allKarya.length > 0 && <Karya client:visible data={recentKarya} />}

    {allBelajar.length > 0 && <Belajar data={recentBelajar} />}

    {allCerita.length > 0 && <Cerita data={recentCerita} />}

    <FaqJoin client:visible />
  </main>
  <Footer />
</MainLayout>
